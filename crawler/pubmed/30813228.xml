<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE collection SYSTEM "BioC.dtd">
<collection><source>PMC</source><date>20201223</date><key>pmc.key</key><document><id>6412534</id><infon key="license">CC BY</infon><passage><infon key="article-id_doi">10.3390/s19040919</infon><infon key="article-id_pmc">6412534</infon><infon key="article-id_pmid">30813228</infon><infon key="article-id_publisher-id">sensors-19-00919</infon><infon key="elocation-id">919</infon><infon key="issue">4</infon><infon key="kwd">indoor localisation fingerprinting crowdsourcing indoor mapping floor plan construction pedestrian dead reckoning unsupervised machine learning time series similarities</infon><infon key="license">Licensee MDPI, Basel, Switzerland. This article is an open access article distributed under the terms and conditions of the Creative Commons Attribution (CC BY) license (http://creativecommons.org/licenses/by/4.0/).</infon><infon key="name_0">surname:Santos;given-names:Ricardo</infon><infon key="name_1">surname:Barandas;given-names:Marília</infon><infon key="name_2">surname:Leonardo;given-names:Ricardo</infon><infon key="name_3">surname:Gamboa;given-names:Hugo</infon><infon key="section_type">TITLE</infon><infon key="type">front</infon><infon key="volume">19</infon><infon key="year">2019</infon><offset>0</offset><text>Fingerprints and Floor Plans Construction for Indoor Localisation Based on Crowdsourcing</text></passage><passage><infon key="section_type">ABSTRACT</infon><infon key="type">abstract</infon><offset>89</offset><text>The demand for easily deployable indoor localisation solutions has been growing. Although several systems have been proposed, their limitations regarding the high implementation costs hinder most of them to be widely used. Fingerprinting-based IPS (Indoor Positioning Systems) depend on characteristics pervasively available in buildings. However, such systems require indoor floor plans, which might not be available, as well as environmental fingerprints, that need to be collected through human resources intensive processes. To overcome these limitations, this paper proposes an algorithm for the automatic construction of indoor maps and fingerprints, solely depending on non-annotated crowdsourced data from smartphones. Our system relies on multiple gait-model based filtering techniques for accurate movement quantification in combination with opportunistic sensing observations. After the reconstruction of users’ movement with PDR (Pedestrian Dead Reckoning) techniques, Wi-Fi measurements are clustered to partition the trajectories into segments. Similar segments, which belong to the same cluster, are identified using an adaptive approach based on a geomagnetic field distance. Finally, the floor plans are obtained through a data fusion process. Merging the acquired environmental data using the obtained floor plan, fingerprints are aligned to physical locations. Experimental results show that the proposed solution achieved comparable floor plans and fingerprints to those acquired manually, allowing the conclusion that is possible to automate the setup process of infrastructure-free IPS.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_1</infon><offset>1700</offset><text>1. Introduction</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>1716</offset><text>The dissemination of smart mobile devices, especially in the last decade, has supported the development of location-based services, which acquired a major role in our daily life. While the GPS (Global Positioning System) is the standard solution for positioning and navigation outdoors, its accuracy is compromised indoors, where the presence of walls and ceilings attenuates the satellite signals.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>2115</offset><text>Considering this problem, several IPS (Indoor Positioning Systems) have been proposed, where alternative sources of information are leveraged. Infrastructure-based solutions require the installation and maintenance of equipment, commonly beacons, to produce artificial signals to be processed. On the other hand, infrastructure-free solutions are based on two major approaches, range-based or fingerprinting-based. Range-based approaches use the distance estimation between reference points and a target object. However, due to signal reflections, non-line-of-sight propagation and object movement, these approaches usually suffer from either low positioning accuracy or high hardware and computational costs. Fingerprinting-based solutions rely in opportunistic readings from signals that are pervasively available in the majority of environments, which lowers their implementation costs.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>3005</offset><text>Nevertheless, this last type of system requires an extensive process to collect the updated buildings information, which may hinder its practical implementation, especially in large-scale applications. Fingerprints that store the buildings’ environmental characteristics, such as the local magnetic field or the Wi-Fi distribution patterns, must be mapped, so that they can be used to locate the device. Furthermore, indoor floor plans are also often essential in these systems, where the layout of the building is registered to ensure the necessary accuracy of the positioning. However, indoor floor plans are not always available, potentially requiring their creation.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>3678</offset><text>The traditional process of constructing floor plans requires the presence of professionals to map the features of the buildings, specifying with precision the dimensions of every room, for example. The mapping of environmental fingerprints is also performed by specialists, who walk through the whole building to collect the data to be used. Both processes are labour-intensive and time-consuming, especially in large buildings, such as malls, hospitals or airports. Moreover, some buildings present dynamics that change their environmental characteristics, as fairs and some shopping areas, requiring recurrent data collections to reconstruct the floor plans and remap the fingerprints. Thus, the search for a easily deployable and scalable solution remains open.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>4443</offset><text>To overcome the aforementioned limitations of current IPS, in recent times, crowdsourcing is being suggested as a way to create self-sustaining systems, which do not require almost any specific human intervention. Crowdsourcing is defined as a contribution model, where a group of anonymous and voluntary people is called to help in solving a problem, developing a task or reaching a goal. The volunteers are motivated to give their contribution in exchange of incentive mechanisms, as for entertainment, money or some service. Several companies and organisations use crowdsourcing in their applications, such as Waze (), an outdoor navigation mobile app, that provides real time traffic information with data collected by their users. Collaborative translation and crowdfunding can also be classified as crowdsourcing applications.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>5276</offset><text>In the indoor location field, crowdsourcing can be used in an opportunistic way, where non-annotated data is collected from the users’ smartphones, such as they naturally move throughout the buildings. This data is then processed to obtain the buildings’ floor plans and/or their environmental fingerprints. Then, by continuously receiving data from different users, the floor plans and fingerprints can be progressively improved.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>5711</offset><text>Taking into consideration the limitations of current IPS and the potentialities of crowdsourcing, we present an innovative algorithm to automatically construct indoor floor plans and environmental fingerprints. It only relies on data collected in a non-annotated way with smart mobile devices, through crowdsourcing-similar techniques. Since we use a large amount of data, collected opportunistically by several users during their usual activities inside buildings, this solution is ready to be applied in crowdsourcing indoor localisation applications. As incentive mechanisms, the users can benefit from the positioning service, while they collect more data to improve the floor plans and fingerprints. Leveraging the inertial and environmental sensors widely available in common smartphones, we are able to reconstruct the users’ trajectories, which carry information about the layout of the buildings. Then, the evaluation of the unique interference patterns on the buildings’ magnetic field, as well as the special features of the Wi-Fi networks, deployed in most of today’s buildings, allows the identification of similarities between the collected data. Our algorithm is then able to merge all the similar data, obtaining an accurate approximation of the buildings’ floor plans and environmental fingerprints, similar to those collected with traditional methods.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>7089</offset><text>Uses unlabelled data, collected opportunistically with crowdsourcing-based techniques, from a large amount of users.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>7206</offset><text>Effortlessly constructs the often unavailable buildings’ floor plans.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>7278</offset><text>Collects the environmental data and maps the fingerprints, required in most fingerprinting-based solutions.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>7386</offset><text>Is able to be widely deployed, since it uses data pervasively available in most buildings.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>7477</offset><text>Is not constrained to buildings with specific characteristics, as with a minimum area or without any open spaces.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>7591</offset><text>The main contributions of this novel unsupervised approach will ease the setup phase of fingerprinting-based IPS. Therefore, we are able to offer a solution that:</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>7754</offset><text>With the contributions of our work, we are able to extend the range of scenarios where location-based services can be applied indoors.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>7889</offset><text>In the following sections, we discuss the previous approaches regarding this topic (Section 2) and describe the architecture of the developed algorithm (Section 3). Finally, the results obtained in the system evaluation are presented (Section 4) and the taken conclusions are drawn (Section 5).</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_1</infon><offset>8184</offset><text>2. Related Work</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>8200</offset><text>Since the last decade, the effort from the scientific community to overcome the implementation limitations of fingerprinting-based IPS has resulted in a large number of solutions. Aiming to diminish the required human effort, these solutions often use crowdsourced data to automatically construct indoor floor plans and/or map environmental fingerprints, relying on several sources of information. Most of existing solutions only address one of the problems, still demanding human effort to implement parts of the system. Other solutions intend to promote completely autonomous systems, but present restrictive limitations.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>8824</offset><text>Regarding the solutions that automatically construct indoor floor plans with pervasively collected data, they often rely on the inertial processing to infer the users’ trajectories. However, the noise accumulation affects the movement reconstruction, creating progressively escalating errors. Therefore, some of these solutions process alternative data sources. Walkie-Markie relies on the Wi-Fi infrastructures available in most buildings to identify landmarks, the locations at which the signal trend on an AP (Access Point) reverses, being used to merge the large volumes of data and to correct the drift errors. SmartSLAM also uses the Wi-Fi signal patterns combined with SLAM (Simultaneous Localisation and Mapping) techniques, to gradually construct the indoor floor plans while tracking the users movement. However, it is only able to map the main areas of the buildings, such as the layout of corridors, annotated with the Wi-Fi measurements. On the other hand, Luo et al. rely on the special characteristics of the geomagnetic field, together with the inertial tracking, to construct indoor floor plans through an hierarchical clustering approach, by identifying similar magnetic sequences. Contrarily, CrowdInside only processes inertial data, to not only reconstruct the users movement, but also to identify landmarks, which in this case consist on special signatures detected in the signals.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>10230</offset><text>When considering the solutions that intend to reduce the effort on the fingerprints acquisition, the floor plan of the buildings is often required, which still might need to be constructed. Zee is a system that reduces the effort of mapping Wi-Fi fingerprints, by tracking the users trajectories indoors. When combining the reconstructed movement and the floor plan constrains, it is possible to obtain the most probable last position of each trajectory. Finally, a backward propagation algorithm attributes the remaining path to the positions of the map, registering the collected data. Jung et al. have developed a solution based on the same principle, where reconstructed trajectories with unlabelled fingerprints are fitted into the floor plan, to identify the corresponding positions. This algorithm has the great advantage of being prepared for the automatic update of fingerprints, to respond to the occasional changes in the buildings. LiFS is an IPS that constructs the crowdsourced fingerprints by processing the floor plans with MDS (Multidimensional Scaling), to improve the match between the trajectories and the processed map.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>11371</offset><text>Although most systems only address one of the problems, some solutions approach both. For example, PiLoc performs clustering to segment the inferred trajectories. Then, the similar ones are identified and the maps and fingerprints are built.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>11613</offset><text>Even though the high number of solutions that have been proposed, it is still needed a solution that is robust enough to satisfy all the needs. Therefore, we propose an innovative solution that surpasses the limited features of the previous systems. Instead of being restrained in the number of sources of information, we rely not only on the traditional inertial data, but also on the buildings’ Wi-Fi signal distribution and the local magnetic field pattern of interferences. By merging these layers of information, we eliminate the need of the buildings’ floor plans, or the need of the partial annotation of the data, done through the definition of an initial number of physical landmarks. Furthermore, our solution is not restrained to the buildings dimensions, while others are limited to buildings with large corridors or without large open spaces, for example. We are also able to reconstruct the floor plans, while others only map the main areas of the buildings. For these reasons, we are able to surpass the limitations of the aforementioned methods by offering an autonomous solution that can be applied in existing IPS.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_1</infon><offset>12750</offset><text>3. Algorithm</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>12763</offset><text>Although the number of solutions that apply crowdsourcing concepts to the indoor location field is increasing, their limitations still hinder them to be widely spread. Some solutions only address one of the problems of fingerprinting-based IPS, where the floor plans are constructed or the fingerprints are mapped. Others present limited accuracy, mainly due to the noisy sensors that accumulate errors through the several stages of the algorithms, or are restricted to specific types of buildings.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>13262</offset><text>In order to overcome those limitations, we present an algorithm that constructs indoor floor plans and environmental fingerprints, without any specific effort from the users. To eliminate the effects of the error accumulation, mainly caused by the inertial sensors in the reconstruction of the movement phase, we combine the traditional PDR (Pedestrian Dead Reckoning) techniques with, not only the information retrieved from the geomagnetic field, but also from the Wi-Fi networks pervasively available in almost every building. Furthermore, unlike most of the current solutions, our system works without any restrains concerning the buildings’ dimensions and characteristics, which enlarges the applicability of autonomous IPS, where small environments, such as homes, can now be considered.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_2</infon><offset>14058</offset><text>3.1. Architecture Overview</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>14085</offset><text>Our algorithm can be divided into four main modules, as it can be understood in Figure 1. The algorithm processes the non-annotated data from the smartphones’ inertial sensors, such as the accelerometer, the gyroscope and the magnetometer. This is done to reconstruct the users’ trajectories through the identification of the human walking patterns, but also to detect similarities between the data collected during the inferred paths. To increase the system’s computational performance and to improve its results, we also collect information about the Wi-Fi networks available in the surroundings. However, considering that some buildings might not have these wireless networks, this information is not mandatory for the proper functioning of the system.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>14847</offset><text>Human movement reconstruction with PDR techniques, through steps detection and stride and heading estimation.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>14957</offset><text>Wi-Fi measurements clustering with unsupervised machine learning techniques.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>15034</offset><text>Geomagnetic data processing and identification of similarities.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>15098</offset><text>Construction of indoor floor plans and mapping of environmental fingerprints, as a result of the fusion of users’ trajectories and filtering operations.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>15253</offset><text>After receiving the crowdsourced data from the users’ smartphones, the following modules are processed sequentially:</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>15372</offset><text>The following sections address the process and each of the four main modules that characterise the presented algorithm, as depicted in Figure 1.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_2</infon><offset>15517</offset><text>3.2. Human Motion</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>15535</offset><text>In the first module of our algorithm, the data collected from the embedded inertial sensors is used to infer the human movement with PDR techniques. This process is an essential requirement to our solution, since it is the reconstruction of the trajectories that allows the construction of floor plans, through the identification of similarities between different users’ trajectories.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_3</infon><offset>15922</offset><text>3.2.1. Trajectories Reconstruction</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>15957</offset><text>The trajectories reconstruction is obtained through the identification of human steps and their corresponding length and direction. A sensor fusion algorithm is implemented to minimise the variations caused by the orientation of the smartphones in relation to the body, but also the imprecisions of the estimation of the magnetic North direction indoors, from the magnetometer. The orientation of the device relative to the Earth reference frame is identified by merging data from the inertial sensors, using a second order complementary filter. Combining the long-term reference to the gravity direction, from the accelerometer, and to the North, from the magnetometer, together with the short-term accuracy of the angular rotation, from the gyroscope, it is possible to orient the smartphones in relation to the Earth frame. With this, we are able to discriminate the accelerations caused by the movement, from the acceleration caused by the gravity.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>16910</offset><text>Accordingly to the study conducted by Zijlstra et al., it is possible to infer the characteristics of the movement with the evaluation of the trunk acceleration data while walking. Since the human movement can be described with a gait model, where each step performed by a user produces cyclic patterns on the acceleration, it is possible to identify the instants when the users’ touch the floor, by the distinct peaks created on the vertical acceleration. To do so, we apply a low pass filter to remove the noise and then a combination of adaptive threshold methods and a decision tree classifier.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>17511</offset><text>Once a step is detected, its length, , is estimated by the Weinberg’s method, which is based on an empirical relationship between the step length and the difference between the maximum and minimum peaks of the vertical acceleration: where  and  are the maximum and minimum vertical accelerations of a step, respectively. K is a calibration constant, recursively adjusted by the least-squares method.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>17913</offset><text>Too characterise the human movement, it is necessary to determine the relative orientation of consecutive steps. Since the computation of the absolute orientation of the user in relation to the magnetic North cannot be obtained with high accuracy, due to magnetic interferences, we process the gyroscope data to obtain the relative changes in the movement heading. By integrating the vertical component of the gyroscope in the Earth frame, , we obtain an angle that represents the heading of the smartphone, , in relation to the heading of a previous instant, , through the result of:</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>18498</offset><text>Since typical consumer-grade gyroscopes present a significant bias error, this integration will cause the inferred trajectories to drift. To minimise this effect, we apply a threshold-based approach to determine whether a user is turning or walking straight. After the determination of the observed drift during a straight line walk, , we refine the heading calculations to precisely obtain the relative variation of the user direction between steps.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>18949</offset><text>After determining all the necessary parameters to characterise the movement, we reconstruct the trajectories by identifying the consecutive positions after each step in a two-dimensional plane. By placing the initial position of each trajectory at the origin of the plane, we compute the subsequent position through the results of: where the achieved position , after a step s was taken, depends on the position of the previous step, , as well as the length of the new step, , and its corresponding direction, .</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_3</infon><offset>19461</offset><text>3.2.2. Domain Conversion</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>19486</offset><text>Human motion in natural environments is complex due to the large variability of walking patterns. For example, two people walking throughout a building, such as an elderly and a young adult, display different walking speeds. To cope with this misalignment in time, a distance domain conversion is applied to the environmental signals (geomagnetic field and Wi-Fi). In other words, instead of having the signals indexed to a certain instant, they will vary accordingly to the distance travelled in each trajectory. Since we have information about the timestamps of every step, as well as their corresponding length, we are able to retrieve the data that was acquired at a given travelled distance, through a linear interpolation.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>20215</offset><text>Independently from the collection device, the magnetic field signals have a high sampling rate. Thus, we are able to choose any fixed step value, from which the corresponding data points will be retrieved. Although we could choose any step value, it is important to guarantee that we have enough data points to accurately represent the signals, but it is also essential to ensure that we do not exceed the necessary points, which would increase the computational complexity. So, we defined the step value as 10 cm. After this process, the geomagnetic field of two routes acquired in the same location, by two different people, can be directly compared. As it can be seen in Figure 2a, the magnetic signals of two routes acquired in the same location are represented in the time domain, while in Figure 2b the same signals were converted, being displayed in the distance domain.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>21093</offset><text>Regarding the Wi-Fi measurements, where the APs’ replies are received in packages, having sampling rates lesser than 1 Hz, an alternative process of conversion is considered. Since we cannot obtain a data point for a fixed distance step, the timestamp of each Wi-Fi reply package is instead converted to a distance, through a linear interpolation between the preceding and following steps. With this process, we obtain each reply package indexed by a distance, instead of an instant.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_2</infon><offset>21579</offset><text>3.3. Wi-Fi</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>21590</offset><text>The second module of our solution includes the processing of the collected Wi-Fi measurements, followed by its evaluation with a clustering technique. Even though this module is not indispensable to construct the indoor maps and fingerprints, it has a significant role on assuring the quality of the results, being also an important factor in lowering the computational costs of the algorithm.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>21984</offset><text>Wi-Fi networks are being used in several fingerprinting-based solutions, supported not only by the wide spread of wireless networks indoors, but also for the signal’s properties. Due to the presence of interferences in the Wi-Fi signal caused by the buildings’ infrastructures, our algorithm deals with typical errors by applying different mechanisms before the clustering process.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>22370</offset><text>The Wi-Fi measurements comprise the information about BSSIDs (Basic Service Set Identifier) detectable from the device at each scan, as well as the information of all WLANs (Wireless Local Area Networks) that they have defined at each radio band (2.4 and 5 GHz), together with the perceived RSSI (Received Signal Strength Indicator). After the pre-processing, the collected data packages from the APs replies, which are the objects to be clustered, are evaluated and different labels are attributed, depending on the final number of clusters. Since the objects of the same cluster have very similar information, it is possible to infer that they were collected in the same area, due to the characteristics of the Wi-Fi networks, such as the uniqueness of each BSSID and the signal’s strength decay pattern.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_3</infon><offset>23179</offset><text>3.3.1. Data Pre-Processing</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>23206</offset><text>The Wi-Fi measurements pre-processing is done not only to extract the required features for the clustering algorithm, but also to diminish the possibilities of error in the final results, related to the identified issues of this signal, that often compromise the accuracy of several solutions. In this sense, the identification of reliable APs for localisation purposes, followed by their signal strength processing for features computation is performed.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>23661</offset><text>The identification of the most reliable APs for the positioning phase consists on a search through the entire data to identify all APs ever detected in the building. In order to eliminate unreliable APs, as smartphone hotspots, that would add dissimilarity to Wi-Fi signals collected in the same place, only APs that emit more than one WLAN are considered.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>24018</offset><text>Regarding the Wi-Fi signal strength processing, the RSSI values from the same AP, collected in the same data package, are merged into a single value using the mean of all WLANs’ RSSIs. Considering that RSSIs below −100 dBm are usually undetectable by most devices, we consider this value as the lower limit of the accepted strength values’ range. With the purpose of standardising the data, APs that are missing in a set of received Wi-Fi measurements will have their signal strength value equals to −100 dBm. Since not all devices support the 5 GHz radio band, we only consider, for the clustering process, the Wi-Fi replies of the WLANs that emit within the 2.4 GHz radio band. With this process, the data collected by different smartphones will have the same characteristics, not influencing the clustering results.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>24845</offset><text>With the packages of Wi-Fi replies processed, the clustering mechanism could be directly applied, where the features would be the RSSI values of the detected APs. However, we verified that signals collected by different smartphones in the same locations vary, which introduce differences in the features depending on the collection device. Therefore, we defined the features of each set of Wi-Fi replies as the RSSI differences between every pair of APs, since the relative RSSIs of the APs between different devices are more consistent.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_3</infon><offset>25383</offset><text>3.3.2. Clustering Mechanism</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>25411</offset><text>In this work, the clustering mechanism will evaluate and label each object, i.e., each collected Wi-Fi reply package. The variety of clustering algorithms that have been proposed in the last decades imposes a careful study about the characteristics required for each context. Depending on the objective of the clustering process, some algorithms might be useful, while others may fail, even though they have proven results. Here, we aim to cluster the Wi-Fi measurements, collected in large quantities with crowdsourcing techniques.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>25944</offset><text>With a high number of objects to be labelled, computationally heavy algorithms will not offer the scalability conditions that we propose. Hierarchical clustering is one of most common approaches, where the partition is achieved progressively through the agglomeration and division of clusters, considering their similarity. Until a stopping criteria is met, which can be hard to define in unknown datasets, the process continues and the similarity between all objects is recomputed to merge/divide the most similar/different ones. This iterative process increases the computational complexity of the clustering process, hindering this algorithm to be applied in large datasets.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>26622</offset><text>Furthermore, the number of dimensions of the feature space, , grows quadratically with the number of detected APs in the building, being expressed by: where n is the number of APs in the building. Thus, clustering algorithms that require the definition of parameters depending on the evaluation of the feature space can hardly be applied. For example, DBSCAN, a density-based algorithm that has been showing promising results, for its capability of detecting outliers, requires the previous determination of , the minimum distance between two objects to be clustered together. With a high number of dimensions, determining the optimum value for this parameter is non-trivial task. Secondly, in DBSCAN, the minimum number of objects in a cluster, , also has to be defined. Based on the assumption that the constitution of the database for different buildings varies, where we cannot previously infer the expected density of a cluster, DBSCAN is not the ideal approach to our goal. Although HDBSCAN resorts to a hierarchical approach to determine , the definition of  remains a problem.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>27707</offset><text>Taking into account the limitations that both the hierarchical and the density-based approaches present, as well as the features that the partitional approach offers, we selected this last one to apply in our solution. K-Means is the most well-known partitional clustering algorithm. It works well in large datasets and has the advantage of being able to adjust the cluster distributions until an optimal point is reached. As K-Means assigns each object to the closest centroid, it tends to produce globular clusters, neglecting the presence of outliers.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>28262</offset><text>After the evaluation of the pros and cons of K-Means, we considered it as the best approach to our purposes. However, partitional algorithms require the definition of the number of clusters as input. Considering that we aim to develop an autonomous solution, with the minimum human interaction possible, a secondary process was implemented to automatically estimate the ideal number of clusters. Firstly, an evaluation graph is computed with the result, for a different number of total clusters, of the sum of the squared distances between each object and its cluster centroid, , given by Equation (5): where K is the number of clusters of each iteration, i represents each object being clustered, and j each feature of the feature space p. Usually, methods that aim to estimate the ideal number of clusters, try to recognise the elbow of the evaluation graph, which represents the point where adding another cluster to the process does not significantly improve the results. However, in order to avoid the introduction of human effort, we further implemented the concept deployed by Zhang et al., which identifies the ideal number of clusters at the point in which the function given by the curvature of the evaluation graph, given by Equation (6), is maximum.  where y represents the previously computed evaluation graph.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>29586</offset><text>To understand the output of this module, Figure 3 has represented a route that was described throughout the building below. A smartphone collected the Wi-Fi data, being each package of APs replies depicted by a circle. The position of each package was obtained with an annotation process, where the timestamp of each turn was registered. Then, with a linear interpolation, the approximate positions of the timestamp for all packages were computed. As it can be seen, the clustering process assigned each package with a different label, depending on the final clustering distribution. With these results, although there are some non-coherent Wi-Fi packages, it is possible to divide the building into four main areas.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_2</infon><offset>30303</offset><text>3.4. Geomagnetic Field</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>30326</offset><text>The third module of this algorithm compares the geomagnetic data to identify similarities between users’ trajectories, which are expected to happen between segments of data that were collected in the same location.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>30543</offset><text>Although the magnetic field remains naturally stable around the same area, its pattern is highly affected indoors. The presence of metallic construction materials and electrical equipment causes disturbances in the geomagnetic pattern, which commonly produce unique patterns that can be used to identify a specific location.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_3</infon><offset>30868</offset><text>3.4.1. Data Segmentation</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>30893</offset><text>Users’ trajectories segmentation based on clustering process.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>30957</offset><text>Straight lines identification using the human movement reconstruction.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>31028</offset><text>Filtering of straight line segments that belong to the same cluster based on their length.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>31119</offset><text>The process of identifying similarities between routes, by comparing the geomagnetic data, increases quadratically the complexity of our algorithm, since all collected magnetic field signals must be compared to each other, considering every possible alignment. To avoid this problem, the magnetic data is subject to the following segmentation process, to reduce the number of comparisons:</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>31508</offset><text>At first, with the results of the clustering module, where Wi-Fi signals are labelled into different clusters, it is possible to segment the users’ trajectories into smaller sections that belong to the same cluster, i.e., a user’s trajectory is divided into sections based on clustering process. Given that each cluster represents a specific area of the building, we can assume that the segmented sections of the same cluster were collected in nearby locations. Therefore, the identification of geomagnetic similarities is only done between trajectories sections of the same cluster.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>32096</offset><text>The human movement reconstruction, obtained from the inertial processing, also gives useful information for easing the complexity of the algorithm. The similar segments that we aim to find in this module will be composed by pairs of segments that were acquired in the exact same locations of a building. Therefore, we are only interested in comparing segments that have similar inertial behaviour, as two straight segments or two turns. Having this in mind, and the fact that a reconstructed turn does not give much certainty, since it could be originated by a sudden tilt on the smartphone, we will retrieve from each trajectory the portion that corresponds to straight line segments, i.e., when the heading estimation between consecutive steps remains constant. Thereby, the obtained segments are composed by straight lines that belong to a unique section, previously identified by the clustering process.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>33004</offset><text>Finally, we apply a cleaning process to remove the straight line segments that are smaller than a defined size, based on the fact that longer similar segments provide more confidence in assuming that they are actually in the same location. For example, it is more likely that two similar segments with 10 m have a unique magnetic field interference pattern, than two similar segments of only one meter, since their shorter patterns might be included in the interference patterns originated by multiple sources. Thus, a minimum of five meters is defined for each segment.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>33575</offset><text>After this process, the complexity of the search for geomagnetic similarities is reduced, as well as the possibility of comparison errors.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_3</infon><offset>33714</offset><text>3.4.2. Similarities Identification</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>33749</offset><text>As it was already mentioned, the identification of similarities is done by comparing the geomagnetic field of the previously segmented sections. Since sections labelled with different clusters were acquired in different areas of the building, we will only be interested in performing comparisons between pairs of straight line segments that were clustered together.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>34115</offset><text>The identification is done through an adaptive approach that uses a distance measure to compare pairs of segments, as illustrated in Figure 4. With the data available in the distance domain, we are able to apply lock-step measures, which compare two time series directly, where the ith point of the first is compared to the ith point of the second. Since the obtained segments have different lengths, depending on the performed trajectory, we apply a sliding window mechanism. Given that the useful characteristics of the magnetic field are the interferences on its stable pattern, the window to be slid is centred around the maximum identified peak on the magnetic field magnitude of each segment (Figure 4a). Then, the distance between the window and each alignment of the segment candidate (Figure 4b) is computed by combining each magnetic field component, through the WPA (Windowed P-norm Alignment) measure, defined in Equation (7): where  stores the distance for each alignment , with l the length of the segment candidate, , and N the length of the window, w.  is computed through the combination of the differences between the corresponding portions of the segment candidate, , and the window, w, for each one of the three magnetic field components, a. The norm p was defined as 1. When the global minimum distance is below a defined similarity threshold, an overlap is identified and the window is extended (Figure 4c) through an iterative process, to determine the length of the overlap. It consists on the recomputation of the WPA measure, where at each iteration the window is extended by 10% of the initial length to both sides, until the limits of the shorter segment or until the global minimum distance stays above the similarity threshold. The similarities identification process is repeated with the inverted segments, based on the assumption that two routes can be acquired in the same place, but with two subjects walking in opposite directions. Thus, an overlap is composed by two similar segments, where the global minimum distance value, , and the maximum achieved window length, , are annotated, so they can be used to construct the floor plans.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>36286</offset><text>The similarity threshold was empirically determined as 0.005, being low enough to avoid the identification of mistaken overlaps. Still, considering the large amount of data that is inherent to crowdsourcing techniques, it is preferable to only use the overlaps in which that we have certainty that they are correct, thus hindering the floor plan reconstruction error accumulation, already caused by the noisy inertial sensors.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_2</infon><offset>36713</offset><text>3.5. Floor Plan and Fingerprints Construction</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>36759</offset><text>The final module of our algorithm relies on the previously identified overlaps to construct the indoor floor plans, as well as mapping the environmental fingerprints.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_3</infon><offset>36926</offset><text>3.5.1. Map Matching</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>36946</offset><text>Using the reconstructed users’ trajectories, collected during their natural moving across the buildings, the preliminary floor plans are constructed, through a process named map matching. This process progressively constructs the floor plans by adding new routes to the map, transforming their coordinate system into the coordinate system of the ones that were already mapped.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>37325</offset><text>A map is defined as a bi-dimensional matrix, where each cell represents a physical location, and stores the number of routes that were mapped into that position. The resolution of the map is defined to be of one square meter, since that precision is enough in the majority of the indoor location applications and is aligned with the accuracies of the available solutions. To match this requirement, each trajectory is transformed to the new resolution.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>37778</offset><text>As mentioned before, a user’s trajectory can be composed by straight line segments that belong to the same cluster. Thus, each segment of a user’s trajectory can match with several segments from different users’ trajectories, since several routes can pass by the same corridor. Moreover, each user’s trajectory can also match with other users’ trajectories in several different segments. Considering this, and to avoid the rise of the computational costs of the algorithm, each route will only be mapped once, through the identification of the overlap that achieved the highest similarity index, given by: weighting the global minimum distance, , proportionally to the maximum window length achieved, . To better understand the map matching process, let us consider that an overlap , composed by the segments  and  from routes  and , respectively, has the highest . Firstly, route  is placed in the centre of the map (bi-dimensional matrix) and next, route  is transformed into the coordinate system of route  through translation and rotation operations, in a way that  and  are overlaid in the map. Then, a search over the overlaps that contain segments  and  is done, and the same transformation process is applied to the new routes. When no more overlaps have neither of the segments already mapped, the search restarts to find the next overlap with the highest , that has one of the routes already in the map, repeating the previous process. This mapping procedure occurs iteratively until there is no possibility to map more routes. At this point, a preliminary floor plan is available. However, if there is still overlaps to be processed, having neither of the routes already in the map, a new map is created and the process is restarted. When all overlaps are processed, among all created floor plans, the one that contains more data is selected as the final floor plan of the building, since it is considered to be the most complete. Nevertheless, with the large amount of data obtained with crowdsourcing, this problem tends to disappear.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_3</infon><offset>39836</offset><text>3.5.2. Floor Plan Filtering</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>39864</offset><text>The reconstructed floor plans have represented the shape of the buildings that were visited by their users. However, the errors originated by the inertial sensors and the great variability of the human movement affect the reconstruction, producing some blurred areas around the main zones. As we always want to produce a well-defined floor plan that can be used for the fingerprints mapping, we implemented a filtering mechanism.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>40294</offset><text>Through the obtained floor plan, the median of the passages over all map positions is calculated. Using this information, all positions that store a number of passages equal or below the calculated median are eliminated, based on the consideration that they do not carry enough data. Since this process often originates sparse sets of positions, we apply a contour identification mechanism to remove them. With the final floor plan properly identified, a binarisation process is employed, generating a final map with the information of the existing areas of the mapped building.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_3</infon><offset>40873</offset><text>3.5.3. Fingerprints Retrieval</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>40903</offset><text>The last step of this module consists on the retrieval of the environmental fingerprints, to be used in common fingerprinting-based indoor location solutions. Depending on the system, different information sources can be used. Here, we focused on the two mainly used sources: the geomagnetic field and the Wi-Fi measurements. Nevertheless, the algorithm is capable of mapping fingerprints for different data, such as the Bluetooth or the sound pattern, introducing only the specific data processing that characterises each type, used in other approaches.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>41458</offset><text>The fingerprints store the environmental readings on the constructed floor plan, in the same resolution of one square meter. For the geomagnetic field, fingerprints for all axes are obtained, while for the Wi-Fi, we produce as many fingerprints as the number of AP at each available radio band. Having the data in the distance domain, it is possible to interpolate the displacement of all data points to obtain the corresponding coordinates in the obtained floor plan. At each position, we perform the mean of values that were collected there, depending on the positioning of the routes in the constructed floor plan. This way, we generate robust fingerprints that have represented data from a wide variety of devices. This method surpasses one problem of the traditional collection methods, where a single device is used to map the fingerprints.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_1</infon><offset>42305</offset><text>4. System Evaluation</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>42326</offset><text>To validate the performance of our algorithm, we conducted an experiment in an office building. The floor plan of the tested building, with about 35 m by 12 m, as well as the corresponding magnetic fingerprint of the vertical component, collected by the traditional methods, are overlaid in Figure 5. The data used for the construction of the traditional magnetic fingerprint, present in Figure 5, was collected using a Samsung S6, through a technique described by Guimarães et al..</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>42810</offset><text>For our system evaluation, data was acquired by six different people, who walked throughout the building, describing 22 different predefined routes. All testers held the smartphones in their hand and collected the data by walking at their natural speed. The acquisition is performed by a logger app, which opportunistically records the sensed data. The annotation of the walked paths was done, to allow the verification of the positioning accuracy with the constructed fingerprints. The users collected data with two different Android smartphones, a LG Nexus 5 and a Huawei Nexus 6P, in different days and in different times of the day, to ensure the variability of data that we want to consider in the final deployment of the system. For over 130 acquisitions, the users collected a total of 95 min of data.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_2</infon><offset>43619</offset><text>4.1. Qualitative Evaluation</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>43647</offset><text>In order to ease the process of fingerprints comparison, a skeletonisation of the original magnetic fingerprints was done. For this skeletonisation, only the areas included in our predefined routes were considered. In Figure 6a, the result of this process, with a resolution of one square meter, is presented. Figure 6b shows the magnetic field fingerprint for the vertical component, constructed with the proposed unsupervised technique. Comparing both fingerprints, we can easily identify that the majority of the areas present similar magnetic field pattern. Although in the bottom values of the Figure 6b (Y lower than 4 m), the intensity values are attenuated when compared to the same area of Figure 6a, the variation pattern can still be identified.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>44404</offset><text>For the floor plans comparison, Figure 7 shows the original skeletonised floor plan of Figure 6a, overlaid with the constructed fingerprint of Figure 6b. Through a comparison between both floor plans, an analysis of the results can be performed. Firstly, we can see that the building is well defined in the constructed floor plan, where most areas are accurately represented in terms of shape and dimensions. For example, the mapped corridors are well defined and the only case where two corridors were merged was in the inferior right corner of the floor plan, which can be explained by the fact that they are separated by less than one meter, gap that is actually lower than the resolution of the map. The right corner of the original floor plan was not mapped in the final floor plan, given that our predefined routes were mainly designed in the office open space. In our collection, only 15% of the acquisitions pass by the unmapped room. Considering that, in free living conditions, there are normal tilting movements that affect the heading estimation, introducing errors on the PDR reconstruction, it is expected that our algorithm does not consider some routes for the final map. Before the floor plan filtering, there were few routes matched in the unmapped room. However, the filtering process, described in Section 3.5.2, eliminated them. We assume that, in a larger dataset, this problem will not be verified. Furthermore, as it can be seen in Figure 6b, the corridors of our floor plan are not shown only by traces, but with the real dimensions where the users walk. The edges of the floor plan also show that the map is constructed with the real pattern of the human movement, since real changes of direction are not done by strict turns of 90º, for example, but with smooth and progressive changes. These outcomes place our algorithm in great advantage in relation to most existing solutions, which only deal with the main traces of the buildings, being limited in environments with special characteristics, as open spaces.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_2</infon><offset>46444</offset><text>4.2. Quantitative Evaluation</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_3</infon><offset>46473</offset><text>4.2.1. Constructed Floor Plan</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>46503</offset><text>Considering the positive results from the previous evaluation of the constructed floor plan, we performed some metrics, to quantitatively confirm the results. This evaluation was done by comparing the constructed floor plan, obtained from the binarisation of Figure 6b, with the original floor plan of the building, in the mapped areas, converted to a resolution of one square meter. To obtain the difference between both maps, we evaluated the floor plan construction as a binary classification problem, where a cell belonging to the map is considered as a positive, while the contrary is considered as a negative. Thus, we were able to perform some statistical metrics. In Table 1, the results of the computed metrics are available. By comparing the correctly constructed positions of the original map, given by the number of aligned one square meter cells, with the total number of positions in the constructed map, we were able to compute its precision. Then, the recall or sensitivity was obtained by comparing the same number of correctly identified positions of the original map with its total number of locations. Finally, the F1 score was computed to provide the certainty of the used tests, given by the harmonic average of the precision and recall.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>47763</offset><text>The outcomes of these metrics confirm the results denoted in the qualitative evaluation. Furthermore, the false positives of the constructed map are present in the neighbouring areas of the existing corridors, which should not have a major impact in the positioning. With most of the areas of the original map correctly reconstructed, we can affirm that our solution is able to automatically construct indoor floor plans for fingerprinting-based IPS, as it will be confirmed in the further analyses.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">title_3</infon><offset>48263</offset><text>4.2.2. Environmental Fingerprints</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>48297</offset><text>In order to quantify the quality of the constructed fingerprints, we performed an evaluation over the environmental data values between the constructed and the original fingerprints. To do so, we used the skeletonised positions, obtained from the original floor plan, to compute the differences between the values of the matching positions in both fingerprints, which are available in Figure 7. In Figure 8, the ECDFs (Empirical Cumulative Distribution Functions) of the computed differences for all axes and magnitude of the magnetic field (Figure 8a), and for all reliable APs at each frequency band of the Wi-Fi (Figure 8b), are presented.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>48940</offset><text>As it can be seen, in the magnetic field, the error does not surpass the 4 T in the percentile 80 of every function, and at 50 percent of the points, the error is below 2 T. On the other hand, the ECDFs of the Wi-Fi measurements also show great results, where the percentile 80 of the error of all APs is below 7 dBm. Furthermore, the mean error for the magnetic field points is 2.38 ± 2.86 T, and for the Wi-Fi measurements is 3.6 ± 2.9 dBm. The results of this comparison show promising results, where the differences between both types of fingerprints are minimal, which is expected to not greatly affect the localisation results.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>49576</offset><text>A further study was implemented, to evaluate the variation of the error depending on the number of routes that were mapped into each position. Figure 9 depicts the error distribution for all skeletonised positions, of the magnetic field’s magnitude, depending on the number of mapped routes. As it can be seen, the maximum error diminishes with the increase in the number of routes. This means that, with a larger dataset, compatible with the final application of the solution in a real scenario, the obtained results are expected to improve.</text></passage><passage><infon key="section_type">INTRO</infon><infon key="type">paragraph</infon><offset>50121</offset><text>At last, the obtained fingerprints were tested in a fingerprinting-based IPS, which processes the Wi-Fi measurements and the magnetic field, to improve the positioning results. Since not all areas of the building were mapped in the constructed floor plan, only the data that was collected through the mapped areas was submitted to the test. Table 2 shows the mean in the positioning error of the tested routes, as well as the maximum error. The outcomes of this test are satisfactory, since the obtained positioning results for both types of fingerprints are very similar, which sustain the previous evaluation results. Although the errors for the constructed fingerprints are higher than the errors for the original ones, these values differ less than a meter. This difference does not affect the localisation purposes in most applications, as in navigation. Still, we expect that with more data, these values will approximate, or even surpass the results obtained with the traditional fingerprints.</text></passage><passage><infon key="section_type">CONCL</infon><infon key="type">title_1</infon><offset>51122</offset><text>5. Conclusions</text></passage><passage><infon key="section_type">CONCL</infon><infon key="type">paragraph</infon><offset>51137</offset><text>This paper presented an innovative approach towards the automatic implementation of fingerprinting-based IPS, by taking advantage of the natural movement of people inside buildings. Relying on crowdsourcing techniques for the data acquisition, it is possible to eliminate the traditional extensive process of data collection, which consists on a laborious site survey to construct the floor plans and fingerprints. Avoiding these restrictive limitations, we were able to develop a solution that can be applied in any building, thus diminishing the gap between the potentialities of indoor and outdoor localisation.</text></passage><passage><infon key="section_type">CONCL</infon><infon key="type">paragraph</infon><offset>51752</offset><text>Our algorithm employs an unsupervised approach to process different natures of data. Through PDR techniques, we are able to reconstruct the movement pattern of the users, the basis for the floor plans reconstruction. By processing the Wi-Fi measurements from the existing networks, we divide the buildings into smaller areas, easing the process of identifying overlaps between different users’ trajectories, done by applying similarity measures to the collected geomagnetic field. With the identified overlaps, the floor plans are then obtained by aligning the crowdsourced trajectories. Finally, we obtain the necessary environmental fingerprints when the collected data is interpolated with the new map positions. Using sensors that are available in most smartphones, our solution dismisses the installation of additional equipment.</text></passage><passage><infon key="section_type">CONCL</infon><infon key="type">paragraph</infon><offset>52589</offset><text>The results that we achieved show that it is possible to obtain comparable floor plans, with fingerprints similar to those collected traditionally. Considering the localisation purposes, this error does not represent a problem, since the resolution is more than enough to accurately lead a person to the correct location.</text></passage><passage><infon key="section_type">AUTH_CONT</infon><infon key="type">title</infon><offset>52911</offset><text>Author Contributions</text></passage><passage><infon key="section_type">AUTH_CONT</infon><infon key="type">paragraph</infon><offset>52932</offset><text>Conceptualisation, M.B.; Data curation, R.S.; Software, R.S. and M.B.; Supervision, M.B., R.L. and H.G.; Validation, R.S. and M.B.; Writing—original draft, R.S.; Writing—review &amp; editing, R.S., M.B., R.L. and H.G.</text></passage><passage><infon key="section_type">ACK_FUND</infon><infon key="type">title</infon><offset>53150</offset><text>Funding</text></passage><passage><infon key="section_type">ACK_FUND</infon><infon key="type">paragraph</infon><offset>53158</offset><text>This research was supported by North Portugal Regional Operational Programme (NORTE 2020), Portugal 2020 and the European Regional Development Fund (ERDF) from European Union through the project Symbiotic technology for societal efficiency gains: Deus ex Machina (DEM), NORTE-01-0145-FEDER-000026.</text></passage><passage><infon key="section_type">COMP_INT</infon><infon key="type">title</infon><offset>53456</offset><text>Conflicts of Interest</text></passage><passage><infon key="section_type">COMP_INT</infon><infon key="type">paragraph</infon><offset>53478</offset><text>The authors declare no conflict of interest.</text></passage><passage><infon key="section_type">REF</infon><infon key="type">title</infon><offset>53523</offset><text>References</text></passage><passage><infon key="fpage">1</infon><infon key="lpage">8</infon><infon key="name_0">surname:Guimarães;given-names:V.</infon><infon key="name_1">surname:Castro;given-names:L.</infon><infon key="name_2">surname:Carneiro;given-names:S.</infon><infon key="name_3">surname:Monteiro;given-names:M.</infon><infon key="name_4">surname:Rocha;given-names:T.</infon><infon key="name_5">surname:Barandas;given-names:M.</infon><infon key="name_6">surname:Machado;given-names:J.</infon><infon key="name_7">surname:Vasconcelos;given-names:M.</infon><infon key="name_8">surname:Gamboa;given-names:H.</infon><infon key="name_9">surname:Elias;given-names:D.</infon><infon key="pub-id_doi">10.1109/IPIN.2016.7743680</infon><infon key="section_type">REF</infon><infon key="source">Proceedings of the 2016 International Conference on Indoor Positioning and Indoor Navigation (IPIN 2016)</infon><infon key="type">ref</infon><offset>53534</offset><text>A Motion Tracking Solution for Indoor Localization Using Smartphones</text></passage><passage><infon key="fpage">143</infon><infon key="lpage">153</infon><infon key="name_0">surname:Luo;given-names:C.</infon><infon key="name_1">surname:Hong;given-names:H.</infon><infon key="name_2">surname:Chan;given-names:M.C.</infon><infon key="pub-id_doi">10.1109/IPSN.2014.6846748</infon><infon key="section_type">REF</infon><infon key="source">Proceedings of the 13th International Symposium on Information Processing in Sensor Networks (Part of CPS Week)</infon><infon key="type">ref</infon><offset>53603</offset><text>PiLoc: A Self-Calibrating Participatory Indoor Localization System</text></passage><passage><infon key="fpage">197</infon><infon key="lpage">210</infon><infon key="name_0">surname:Wang;given-names:H.</infon><infon key="name_1">surname:Sen;given-names:S.</infon><infon key="name_2">surname:Elgohary;given-names:A.</infon><infon key="name_3">surname:Farid;given-names:M.</infon><infon key="name_4">surname:Youssef;given-names:M.</infon><infon key="name_5">surname:Choudhury;given-names:R.R.</infon><infon key="pub-id_doi">10.1145/2307636.2307655</infon><infon key="section_type">REF</infon><infon key="source">Proceedings of the 10th International Conference on Mobile Systems, Applications, and Services (MobiSys ’12)</infon><infon key="type">ref</infon><offset>53670</offset><text>No Need to War-Drive: Unsupervised Indoor Localization</text></passage><passage><infon key="fpage">269</infon><infon key="lpage">280</infon><infon key="name_0">surname:Yang;given-names:Z.</infon><infon key="name_1">surname:Wu;given-names:C.</infon><infon key="name_2">surname:Liu;given-names:Y.</infon><infon key="pub-id_doi">10.1145/2348543.2348578</infon><infon key="section_type">REF</infon><infon key="source">Proceedings of the 18th Annual International Conference on Mobile Computing and Networking (Mobicom ’12)</infon><infon key="type">ref</infon><infon key="year">2012</infon><offset>53725</offset><text>Locating in Fingerprint Space: Wireless Indoor Localization with Little Human Intervention</text></passage><passage><infon key="fpage">1443</infon><infon key="lpage">1457</infon><infon key="name_0">surname:Shu;given-names:Y.</infon><infon key="name_1">surname:Bo;given-names:C.</infon><infon key="name_2">surname:Shen;given-names:G.</infon><infon key="name_3">surname:Zhao;given-names:C.</infon><infon key="name_4">surname:Li;given-names:L.</infon><infon key="name_5">surname:Zhao;given-names:F.</infon><infon key="pub-id_doi">10.1109/JSAC.2015.2430274</infon><infon key="section_type">REF</infon><infon key="source">IEEE J. Sel. Areas Commun.</infon><infon key="type">ref</infon><infon key="volume">33</infon><infon key="year">2015</infon><offset>53816</offset><text>Magicol: Indoor Localization Using Pervasive Magnetic Field and Opportunistic Wi-Fi Sensing</text></passage><passage><infon key="fpage">775</infon><infon key="lpage">784</infon><infon key="name_0">surname:Bahl;given-names:P.</infon><infon key="name_1">surname:Padmanabhan;given-names:V.N.</infon><infon key="pub-id_doi">10.1109/INFCOM.2000.832252</infon><infon key="section_type">REF</infon><infon key="source">Proceedings of the Nineteenth Annual Joint Conference of the IEEE Computer and Communications Societies (INFOCOM 2000)</infon><infon key="type">ref</infon><infon key="volume">Volume 2</infon><offset>53908</offset><text>RADAR: An In-Building RF-Based User Location and Tracking System</text></passage><passage><infon key="fpage">1406</infon><infon key="lpage">1417</infon><infon key="name_0">surname:Chen;given-names:L.</infon><infon key="name_1">surname:Yang;given-names:K.</infon><infon key="name_2">surname:Wang;given-names:X.</infon><infon key="pub-id_doi">10.1109/JIOT.2016.2609405</infon><infon key="section_type">REF</infon><infon key="source">IEEE Internet Things J.</infon><infon key="type">ref</infon><infon key="volume">3</infon><infon key="year">2016</infon><offset>53973</offset><text>Robust Cooperative Wi-Fi Fingerprint-Based Indoor Localization</text></passage><passage><infon key="fpage">2</infon><infon key="lpage">7</infon><infon key="name_0">surname:Vikas;given-names:C.M.</infon><infon key="name_1">surname:Rajendran;given-names:S.</infon><infon key="name_2">surname:Pattar;given-names:A.</infon><infon key="name_3">surname:Jamadagni;given-names:H.S.</infon><infon key="name_4">surname:Budihal;given-names:R.</infon><infon key="pub-id_doi">10.1109/ICONSIP.2016.7857443</infon><infon key="section_type">REF</infon><infon key="source">Proceedings of the 2016 International Conference on Signal and Information Processing (IConSIP 2016)</infon><infon key="type">ref</infon><offset>54036</offset><text>WiFi RSSI and Inertial Sensor Based Indoor Localisation System: A Simplified Hybrid Approach</text></passage><passage><infon key="fpage">21824</infon><infon key="lpage">21843</infon><infon key="name_0">surname:Ma;given-names:R.</infon><infon key="name_1">surname:Guo;given-names:Q.</infon><infon key="name_2">surname:Hu;given-names:C.</infon><infon key="name_3">surname:Xue;given-names:J.</infon><infon key="pub-id_doi">10.3390/s150921824</infon><infon key="pub-id_pmid">26334278</infon><infon key="section_type">REF</infon><infon key="source">Sensors</infon><infon key="type">ref</infon><infon key="volume">15</infon><infon key="year">2015</infon><offset>54129</offset><text>An Improved WiFi Indoor Positioning Algorithm by Weighted Fusion</text></passage><passage><infon key="fpage">898</infon><infon key="lpage">908</infon><infon key="name_0">surname:Liu;given-names:K.</infon><infon key="name_1">surname:Zhang;given-names:H.</infon><infon key="name_2">surname:Ng;given-names:J.K.</infon><infon key="name_3">surname:Xia;given-names:Y.</infon><infon key="name_4">surname:Feng;given-names:L.</infon><infon key="name_5">surname:Lee;given-names:V.C.S.</infon><infon key="name_6">surname:Son;given-names:S.H.</infon><infon key="pub-id_doi">10.1109/TII.2017.2750240</infon><infon key="section_type">REF</infon><infon key="source">IEEE Trans. Ind. Inform.</infon><infon key="type">ref</infon><infon key="volume">14</infon><infon key="year">2018</infon><offset>54194</offset><text>Toward Low-Overhead Fingerprint-Based Indoor Localization via Transfer Learning: Design, Implementation, and Evaluation</text></passage><passage><infon key="elocation-id">2678</infon><infon key="name_0">surname:Luo;given-names:H.</infon><infon key="name_1">surname:Zhao;given-names:F.</infon><infon key="name_2">surname:Jiang;given-names:M.</infon><infon key="name_3">surname:Ma;given-names:H.</infon><infon key="name_4">surname:Zhang;given-names:Y.</infon><infon key="pub-id_doi">10.3390/s17112678</infon><infon key="pub-id_pmid">29156639</infon><infon key="section_type">REF</infon><infon key="source">Sensors</infon><infon key="type">ref</infon><infon key="volume">17</infon><infon key="year">2017</infon><offset>54314</offset><text>Constructing an Indoor Floor Plan Using Crowdsourcing Based on Magnetic Fingerprinting</text></passage><passage><infon key="fpage">36</infon><infon key="lpage">44</infon><infon key="name_0">surname:Chatzimilioudis;given-names:G.</infon><infon key="name_1">surname:Konstantinidis;given-names:A.</infon><infon key="name_2">surname:Laoudias;given-names:C.</infon><infon key="name_3">surname:Zeinalipour-Yazti;given-names:D.</infon><infon key="pub-id_doi">10.1109/MIC.2012.70</infon><infon key="section_type">REF</infon><infon key="source">IEEE Internet Comput.</infon><infon key="type">ref</infon><infon key="volume">16</infon><infon key="year">2012</infon><offset>54401</offset><text>Crowdsourcing with Smartphones</text></passage><passage><infon key="fpage">54</infon><infon key="lpage">67</infon><infon key="name_0">surname:Zhang;given-names:X.</infon><infon key="name_1">surname:Yang;given-names:Z.</infon><infon key="name_2">surname:Sun;given-names:W.</infon><infon key="name_3">surname:Liu;given-names:Y.</infon><infon key="name_4">surname:Tang;given-names:S.</infon><infon key="name_5">surname:Xing;given-names:K.</infon><infon key="name_6">surname:Mao;given-names:X.</infon><infon key="pub-id_doi">10.1109/COMST.2015.2415528</infon><infon key="section_type">REF</infon><infon key="source">IEEE Commun. Surv. Tutor.</infon><infon key="type">ref</infon><infon key="volume">18</infon><infon key="year">2016</infon><offset>54432</offset><text>Incentives for Mobile Crowd Sensing: A Survey</text></passage><passage><infon key="fpage">85</infon><infon key="lpage">98</infon><infon key="name_0">surname:Shen;given-names:G.</infon><infon key="name_1">surname:Chen;given-names:Z.</infon><infon key="name_2">surname:Zhang;given-names:P.</infon><infon key="name_3">surname:Moscibroda;given-names:T.</infon><infon key="name_4">surname:Zhang;given-names:Y.</infon><infon key="section_type">REF</infon><infon key="source">Proceedings of the 10th USENIX Symposium on Networked Systems Design and Implementation (NSDI ’13)</infon><infon key="type">ref</infon><offset>54478</offset><text>Walkie-Markie: Indoor Pathway Mapping Made Easy</text></passage><passage><infon key="fpage">889</infon><infon key="lpage">898</infon><infon key="name_0">surname:Shin;given-names:H.</infon><infon key="name_1">surname:Chon;given-names:Y.</infon><infon key="name_2">surname:Cha;given-names:H.</infon><infon key="pub-id_doi">10.1109/TSMCC.2011.2169403</infon><infon key="section_type">REF</infon><infon key="source">IEEE Trans. Syst. Man Cybern. Part C Appl. Rev.</infon><infon key="type">ref</infon><infon key="volume">42</infon><infon key="year">2012</infon><offset>54526</offset><text>Unsupervised Construction of an Indoor Floor Plan Using a Smartphone</text></passage><passage><infon key="fpage">99</infon><infon key="lpage">110</infon><infon key="name_0">surname:Durrant-Whyte;given-names:H.</infon><infon key="name_1">surname:Bailey;given-names:T.</infon><infon key="pub-id_doi">10.1109/MRA.2006.1638022</infon><infon key="section_type">REF</infon><infon key="source">IEEE Robot. Autom. Mag.</infon><infon key="type">ref</infon><infon key="volume">13</infon><infon key="year">2006</infon><offset>54595</offset><text>Simultaneous localization and mapping: Part I</text></passage><passage><infon key="fpage">99</infon><infon key="lpage">108</infon><infon key="name_0">surname:Alzantot;given-names:M.</infon><infon key="name_1">surname:Youssef;given-names:M.</infon><infon key="pub-id_doi">10.1145/2424321.2424335</infon><infon key="section_type">REF</infon><infon key="source">Proceedings of the 20th International Conference on Advances in Geographic Information Systems (SIGSPATIAL ’12)</infon><infon key="type">ref</infon><offset>54641</offset><text>CrowdInside: Automatic Construction of Indoor Floorplans</text></passage><passage><infon key="name_0">surname:Rai;given-names:A.</infon><infon key="name_1">surname:Chintalapudi;given-names:K.K.</infon><infon key="name_2">surname:Padmanabhan;given-names:V.N.</infon><infon key="name_3">surname:Sen;given-names:R.</infon><infon key="pub-id_doi">10.1145/2348543.2348580</infon><infon key="section_type">REF</infon><infon key="source">Proceedings of the 18th Annual International Conference on Mobile Computing and Networking (Mobicom ’12)</infon><infon key="type">ref</infon><offset>54698</offset><text>Zee: Zero-Effort Crowdsourcing for Indoor Localization</text></passage><passage><infon key="fpage">1764</infon><infon key="lpage">1777</infon><infon key="name_0">surname:Jung;given-names:S.</infon><infon key="name_1">surname:Han;given-names:D.</infon><infon key="pub-id_doi">10.1109/ACCESS.2017.2780243</infon><infon key="section_type">REF</infon><infon key="source">IEEE Access</infon><infon key="type">ref</infon><infon key="volume">6</infon><infon key="year">2018</infon><offset>54753</offset><text>Automated Construction and Maintenance of Wi-Fi Radio Maps for Crowdsourcing-Based Indoor Positioning Systems</text></passage><passage><infon key="fpage">1</infon><infon key="lpage">10</infon><infon key="name_0">surname:Zijlstra;given-names:W.</infon><infon key="name_1">surname:Hof;given-names:A.L.</infon><infon key="pub-id_doi">10.1016/S0966-6362(02)00190-X</infon><infon key="section_type">REF</infon><infon key="source">Gait Posture</infon><infon key="type">ref</infon><infon key="volume">18</infon><infon key="year">2003</infon><offset>54863</offset><text>Assessment of spatio-temporal gait parameters from trunk accelerations during human walking</text></passage><passage><infon key="comment">Analog Devices Application Note AN-602</infon><infon key="name_0">surname:Weinberg;given-names:H.</infon><infon key="section_type">REF</infon><infon key="source">Using the ADXL202 in Pedometer and Personal Navigation Applications</infon><infon key="type">ref</infon><infon key="year">2002</infon><offset>54955</offset></passage><passage><infon key="fpage">1</infon><infon key="lpage">9</infon><infon key="name_0">surname:Guo;given-names:D.</infon><infon key="name_1">surname:Zhang;given-names:Y.</infon><infon key="name_2">surname:Xiang;given-names:Q.</infon><infon key="name_3">surname:Li;given-names:Z.</infon><infon key="pub-id_doi">10.1155/2014/420482</infon><infon key="section_type">REF</infon><infon key="source">Math. Probl. Eng.</infon><infon key="type">ref</infon><infon key="volume">2014</infon><infon key="year">2014</infon><offset>54956</offset><text>Improved Radio Frequency Identification Indoor Localization Method Via Radial Basis Function Neural Network</text></passage><passage><infon key="fpage">226</infon><infon key="lpage">231</infon><infon key="name_0">surname:Ester;given-names:M.</infon><infon key="name_1">surname:Kriegel;given-names:H.P.</infon><infon key="name_2">surname:Sander;given-names:J.</infon><infon key="name_3">surname:Xu;given-names:X.</infon><infon key="section_type">REF</infon><infon key="source">Proceedings of the Second International Conference on Knowledge Discovery and Data Mining (KDD’96)</infon><infon key="type">ref</infon><infon key="year">1996</infon><offset>55064</offset><text>A Density-based Algorithm for Discovering Clusters a Density-based Algorithm for Discovering Clusters in Large Spatial Databases with Noise</text></passage><passage><infon key="fpage">160</infon><infon key="lpage">172</infon><infon key="name_0">surname:Campello;given-names:R.J.</infon><infon key="name_1">surname:Moulavi;given-names:D.</infon><infon key="name_2">surname:Sander;given-names:J.</infon><infon key="pub-id_doi">10.1007/978-3-642-37456-2_14</infon><infon key="section_type">REF</infon><infon key="source">Proceedings of the Pacific-Asia Conference on Knowledge Discovery and Data Mining</infon><infon key="type">ref</infon><infon key="year">2013</infon><offset>55204</offset><text>Density-based clustering based on hierarchical density estimates</text></passage><passage><infon key="fpage">651</infon><infon key="lpage">666</infon><infon key="name_0">surname:Jain;given-names:A.K.</infon><infon key="pub-id_doi">10.1016/j.patrec.2009.09.011</infon><infon key="section_type">REF</infon><infon key="source">Pattern Recognit. Lett.</infon><infon key="type">ref</infon><infon key="volume">31</infon><infon key="year">2010</infon><offset>55269</offset><text>Data Clustering: 50 Years Beyond K-Means</text></passage><passage><infon key="fpage">414</infon><infon key="lpage">428</infon><infon key="name_0">surname:Zhang;given-names:Y.</infon><infon key="name_1">surname:Mandziuk;given-names:J.</infon><infon key="name_2">surname:Quek;given-names:C.H.</infon><infon key="name_3">surname:Goh;given-names:B.W.</infon><infon key="pub-id_doi">10.1016/j.ins.2017.05.024</infon><infon key="section_type">REF</infon><infon key="source">Inf. Sci.</infon><infon key="type">ref</infon><infon key="volume">416</infon><infon key="year">2017</infon><offset>55310</offset><text>Curvature-Based Method for Determining the Number of Clusters</text></passage><passage><infon key="fpage">275</infon><infon key="lpage">309</infon><infon key="name_0">surname:Wang;given-names:X.</infon><infon key="name_1">surname:Mueen;given-names:A.</infon><infon key="name_2">surname:Ding;given-names:H.</infon><infon key="name_3">surname:Trajcevski;given-names:G.</infon><infon key="name_4">surname:Scheuermann;given-names:P.</infon><infon key="pub-id_doi">10.1007/s10618-012-0250-5</infon><infon key="section_type">REF</infon><infon key="source">Data Min. Knowl. Discov.</infon><infon key="type">ref</infon><infon key="volume">26</infon><infon key="year">2013</infon><offset>55372</offset><text>Experimental Comparison of Representation Methods and Distance Measures for Time Series Data</text></passage><passage><infon key="name_0">surname:Folgado;given-names:D.</infon><infon key="section_type">REF</infon><infon key="source">Master’s Thesis</infon><infon key="type">ref</infon><infon key="year">2015</infon><offset>55465</offset><text>Measuring Repetitive Tasks Using Inertial Sensors</text></passage><passage><infon key="fpage">125</infon><infon key="lpage">140</infon><infon key="name_0">surname:Lymberopoulos;given-names:D.</infon><infon key="name_1">surname:Liu;given-names:J.</infon><infon key="pub-id_doi">10.1109/MSP.2017.2713817</infon><infon key="section_type">REF</infon><infon key="source">IEEE Signal Process. Mag.</infon><infon key="type">ref</infon><infon key="volume">34</infon><infon key="year">2017</infon><offset>55515</offset><text>The Microsoft Indoor Localization Competition: Experiences and Lessons Learned</text></passage><passage><infon key="fpage">4136</infon><infon key="lpage">4144</infon><infon key="name_0">surname:Leonardo;given-names:R.</infon><infon key="name_1">surname:Barandas;given-names:M.</infon><infon key="name_2">surname:Gamboa;given-names:H.</infon><infon key="pub-id_doi">10.1109/JSEN.2018.2817887</infon><infon key="section_type">REF</infon><infon key="source">IEEE Sens. J.</infon><infon key="type">ref</infon><infon key="volume">18</infon><infon key="year">2018</infon><offset>55594</offset><text>A Framework for Infrastructure-Free Indoor Localization Based on Pervasive Sound Analysis</text></passage><passage><infon key="file">sensors-19-00919-g001.jpg</infon><infon key="id">sensors-19-00919-f001</infon><infon key="section_type">FIG</infon><infon key="type">fig_caption</infon><offset>55684</offset><text>Architecture of the proposed algorithm for the automatic construction of indoor floor plans and environmental fingerprints.</text></passage><passage><infon key="file">sensors-19-00919-g002.jpg</infon><infon key="id">sensors-19-00919-f002</infon><infon key="section_type">FIG</infon><infon key="type">fig_caption</infon><offset>55808</offset><text>Results of the magnetic signal domain conversion. In (a), the magnitude of the magnetic field for two routes collected through the same path, by two different people, are represented in the time domain. In (b), the signals of the same routes are represented in the distance domain, after the domain conversion process, as it can be denoted by the interference pattern alignment.</text></passage><passage><infon key="file">sensors-19-00919-g003.jpg</infon><infon key="id">sensors-19-00919-f003</infon><infon key="section_type">FIG</infon><infon key="type">fig_caption</infon><offset>56187</offset><text>Example of the clustering distribution of the APs (Access Points) replies packages, for a route collected throughout a building.</text></passage><passage><infon key="file">sensors-19-00919-g004.jpg</infon><infon key="id">sensors-19-00919-f004</infon><infon key="section_type">FIG</infon><infon key="type">fig_caption</infon><offset>56316</offset><text>Overlap identification process, between segments  and . In (a), a window around the maximum peak of segment  is retrieved and compared in (b) with the segment , through a sliding mechanism. Then, in (c), the overlap  is identified by the alignment that gave the higher similarity. A further process is applied, where the window is iteratively extended to verify the length of the overlap, until the limits of the segments are reached or until a dissimilarity is found.</text></passage><passage><infon key="file">sensors-19-00919-g005.jpg</infon><infon key="id">sensors-19-00919-f005</infon><infon key="section_type">FIG</infon><infon key="type">fig_caption</infon><offset>56785</offset><text>Original floor plan of the tested building, with the vertical component of the magnetic field fingerprint overlaid.</text></passage><passage><infon key="file">sensors-19-00919-g006.jpg</infon><infon key="id">sensors-19-00919-f006</infon><infon key="section_type">FIG</infon><infon key="type">fig_caption</infon><offset>56901</offset><text>Magnetic field fingerprints for the vertical component. In (a), a squeletonised fingerprint collected with the traditional methods is represented. On the other hand, (b) has the fingerprint for the same component, but constructed with the proposed algorithm.</text></passage><passage><infon key="file">sensors-19-00919-g007.jpg</infon><infon key="id">sensors-19-00919-f007</infon><infon key="section_type">FIG</infon><infon key="type">fig_caption</infon><offset>57160</offset><text>Original skeletonised floor plan, overlaid with the constructed fingerprint of the magnetic field vertical component.</text></passage><passage><infon key="file">sensors-19-00919-g008.jpg</infon><infon key="id">sensors-19-00919-f008</infon><infon key="section_type">FIG</infon><infon key="type">fig_caption</infon><offset>57278</offset><text>ECDFs (Empirical Cumulative Distribution Functions) for the errors in the constructed fingerprints. In (a), the ECDF is computed for each axis of the magnetometer, as well as the magnitude. In (b), a ECDF was computed for each AP, at each radio band.</text></passage><passage><infon key="file">sensors-19-00919-g009.jpg</infon><infon key="id">sensors-19-00919-f009</infon><infon key="section_type">FIG</infon><infon key="type">fig_caption</infon><offset>57529</offset><text>Distribution of the error of the magnetic field magnitude fingerprint, depending on the number of mapped routes in each position.</text></passage><passage><infon key="file">sensors-19-00919-t001.xml</infon><infon key="id">sensors-19-00919-t001</infon><infon key="section_type">TABLE</infon><infon key="type">table_caption</infon><offset>57659</offset><text>Statistical metrics results, obtained from the comparison of the constructed and the original floor plan, for the test building.</text></passage><passage><infon key="file">sensors-19-00919-t001.xml</infon><infon key="id">sensors-19-00919-t001</infon><infon key="section_type">TABLE</infon><infon key="type">table</infon><infon key="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;table frame=&quot;hsides&quot; rules=&quot;groups&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin;border-top:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Precision&lt;/th&gt;&lt;th align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin;border-top:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Recall&lt;/th&gt;&lt;th align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin;border-top:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;F1 Score&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;67.1%&lt;/td&gt;&lt;td align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;77.4%&lt;/td&gt;&lt;td align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;71.8%&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
</infon><offset>57789</offset><text>Precision	Recall	F1 Score	 	67.1%	77.4%	71.8%	 	</text></passage><passage><infon key="file">sensors-19-00919-t002.xml</infon><infon key="id">sensors-19-00919-t002</infon><infon key="section_type">TABLE</infon><infon key="type">table_caption</infon><offset>57838</offset><text>Positioning results, obtained with both types of fingerprints. Each cell represents the mean and the standard deviation for the mean and maximum errors of all tested routes.</text></passage><passage><infon key="file">sensors-19-00919-t002.xml</infon><infon key="id">sensors-19-00919-t002</infon><infon key="section_type">TABLE</infon><infon key="type">table</infon><infon key="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;table frame=&quot;hsides&quot; rules=&quot;groups&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin;border-top:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Positioning Results&lt;/th&gt;&lt;th align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin;border-top:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Constructed Fingerprints&lt;/th&gt;&lt;th align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin;border-top:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Original Fingerprints&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td align=&quot;center&quot; valign=&quot;middle&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Mean Error (m)&lt;/td&gt;&lt;td align=&quot;center&quot; valign=&quot;middle&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;4.4 ± 2.0&lt;/td&gt;&lt;td align=&quot;center&quot; valign=&quot;middle&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;3.7 ± 1.8&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;Maximum Error (m)&lt;/td&gt;&lt;td align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;6.5 ± 2.6&lt;/td&gt;&lt;td align=&quot;center&quot; valign=&quot;middle&quot; style=&quot;border-bottom:solid thin&quot; rowspan=&quot;1&quot; colspan=&quot;1&quot;&gt;5.7 ± 2.3&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
</infon><offset>58013</offset><text>Positioning Results	Constructed Fingerprints	Original Fingerprints	 	Mean Error (m)	4.4 ± 2.0	3.7 ± 1.8	 	Maximum Error (m)	6.5 ± 2.6	5.7 ± 2.3	 	</text></passage></document></collection>
